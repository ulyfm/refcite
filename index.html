<!DOCTYPE html>
<html>
<head>
	<title>RefCite - Cite Sources!</title>

	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	

	<style type="text/css">
		
		#savedcitations {
			font-family: "Times New Roman", Times, serif;
		}
		#manualentry{
			border-color: #1B1464;
			background-color: #1B1464;
		}
		#searchdiv, #verifydiv {
			display: none;
		}
	</style>

</head>
<body>
	<br>
	<div class="container-fluid">
	<div class="container">
	<h2>Create a Citation</h2>
	<form name="search" onsubmit="return cite()">
		<div class="form-group">
			<div class="row">
				<div class="col-8">
				<input type="text" class="form-control" id="bigbox" placeholder="Enter DOI, Link, Title, etc...">
				</div>
				<div class="col-3">
				<input type="submit" class="btn btn-primary" value="Search">
				</div>
			</div>
		</div>
	</form>
	<div class="row">
		<div class="col-8"></div>
		<div class="col-3">
		<input type="submit" value="Manual Entry" id="manualentry" class="btn btn-primary" onclick="displayGeneric('other','','','','','','','','','','','','','','','')">
		</div>
	</div>
	</div>
	<div id="searchdiv" class="container">
		<hr align="left" />
		<div id="searchresults">
			
		</div>
		<input type="submit" class="btn btn-danger" value="Cancel">
	</div>
	<br>
	<div class="row">
	<div id="verifydiv" class="jumbotron container col-8">
		<h3>Verify Details</h3>
		Not all fields need to be filled out. Do the best you can! Citing sources is not a precise endeavor.<br><br>
		<form name="verify" id="verifyform">
			<div class="form-group">
			<b>Source Format: </b>
			<select id="vsf" class="form-control">
				<option value="journal-article">Journal Article</option>
				<option value="book">Book</option>
				<option value="website">Website</option>
				<option value="other">Other</option>
			</select>
			<br>
			<b>Authors:</b>
			<div id="authdiv">
				
			</div>
			<br>
			<a class="but btn btn-primary" href="javascript:changeAuthors(1)">Add Author</a>
			<a class="but btn btn-danger" href="javascript:changeAuthors(0)">Remove Author</a>
			<br><br>
			<b>Title:</b><input type="text" id="vtitl" class="form-control" placeholder="">
			<b>Date Published:</b>
			<div class="row">
			<div class="col-4">Year: <input type="text" class="date form-control" id="vyear" placeholder=""></div>
			<div class="col-4">Month: <input type="text" class="date form-control" id="vmont" placeholder=""></div>
			<div class="col-4">Day: <input type="text" class="date form-control" id="vday" placeholder=""></div>
			</div>
			<b>Journal Name (if journal article):</b><input type="text" id="vjnam" class="form-control" placeholder="">
			<b>URL:</b><input type=text class="form-control" id="vurl" placeholder="">
			<div class="row">
			<div class="col-6"><b>Publisher:</b><input type="text" class="form-control" id="vpubl" placeholder=""></div>
			<div class="col-6"><b>Publisher Location:</b><input type="text" class="form-control" id="vpubloc" placeholder=""></div>
			</div>
			<div class="row">
			<div class="col-6"><b>Volume:</b><input type="text" id="vvol" class="date form-control" placeholder=""></div><div class="col-6"><b>Issue:</b><input type="text" id="viss" class="date form-control" placeholder=""></div>
			</div>
			<b>Pages:</b><input type="text" id="vpag" class="form-control" placeholder="">
			<b>Date Last Updated (only used for websites):</b><br>
			<div class="row">
			<div class="col-4">Year: <input type="text" class="date form-control" id="vuyear" placeholder=""></div>
			<div class="col-4">Month: <input type="text" class="date form-control" id="vumont" placeholder=""></div>
			<div class="col-4">Day: <input type="text" class="date form-control" id="vuday" placeholder=""></div>
			</div>
			<br><br>
			<div class="row">
				<div class="col-6">
					<a class="btn btn-danger" onclick="return clearVerify()">Cancel</a>
				</div>
				<div class="col-6">
					<input type="submit" class="btn btn-primary" value="Approve Citation">
				</div>
			</div>
			</div>
		</form>
	</div>
	<div class="col-3"></div>
	</div>
	<hr align="left"/>
	<div id="citations" class="container">
		<h2>Your Citations:</h2>
		<input type="submit" class="btn btn-info" value="MLA" name="MLA" onclick="updateFormat('MLA')">
		<input type="submit" class="btn btn-secondary" value="APA" name="APA" onclick="updateFormat('APA')">
		<input type="submit" class="btn btn-success" value="Chicago" name="ChicagoA" onclick="updateFormat('Chicago')">
		<br><br>
		<div id="savedcitations">
			
		</div>
		<br>
		<input type="submit" class="btn btn-danger" value="Clear Citations" onclick="clearCitations()">
		<br><br>
	</div>
</div>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			if(document.cookie != "" && document.cookie != "saved="){
				/*alert(document.cookie);
				alert(document.cookie.substring(6, document.cookie.length - 1));
				alert(atob(document.cookie.substring(6, document.cookie.length - 1)));*/
				citations = JSON.parse(atob(document.cookie.substring(6, document.cookie.length - 1))).mainList;
				updateDisplay();
			}
		});
		$("#verifyform").submit(function(event){
			event.preventDefault();
			var neo = currentCitation;

			var savf = document.getElementsByClassName("vauthf");
			var savl = document.getElementsByClassName("vauthl");
			var newauths = [];
			for(var a = 0; a < savf.length; ++a){
				newauths.push({family:savl[a].value, given:savf[a].value});
			}
			neo.authors = newauths;
			//re-enter citation modified values. TODO
			neo.genre = $("#vsf").val();
			neo.title = $('#vtitl').val();
			neo.year = $('#vyear').val();
			neo.month = $('#vmont').val();
			neo.day = $('#vday').val();
			neo.journal_name = $('#vjnam').val();
			neo.doi_url = $('#vurl').val();
			neo.publisher = $('#vpubl').val();
			neo.pubcity = $('#vpubloc').val();
			neo.volume = $('#vvol').val();
			neo.issue = $('#viss').val();
			neo.pages = $('#vpag').val();
			neo.updatedyear = $('#vuyear').val();
			neo.updatedmonth = $('#vumont').val();
			neo.updatedday = $('#vuday').val();
			$("#verifydiv").hide();
			citations.push(neo);
			document.cookie = "saved=" + btoa(JSON.stringify({"mainList": citations})) + ";";
			//alert(btoa(JSON.stringify({"mainList": citations})));
			updateDisplay();
			return false;
		});
		function clearVerify(){
			$("#verifydiv").hide();
			return false;
		}
		function cite(){

			var query = $("#bigbox").val();
			var doi = false;
			//DOI Input
			if(query.toLowerCase().startsWith("10.") || query.toLowerCase().startsWith("https://doi.org") || query.toLowerCase().startsWith("https://dx.doi.org")){
				var request = createCORSRequest("get", "http://api.unpaywall.org/v2/" + query + "?email=" + Math.random().toString(36).substring(7));
				if (request){
    				request.onload = function() {
    					var text = JSON.parse(request.responseText);
    					if(text.HTTP_status_code != "404"){
    						doi = true;
    						//get issue, volume, etc.
    						var request2 = createCORSRequest("get", "https://api.crossref.org/works/" + query);
    						if (request2){
    							request2.onload = function() {
    								
    								var msg = JSON.parse(request2.responseText).message;
    								var unp_date = text.published_date.split("-");
    								var month = parseInt(unp_date[1]);
    								var day = parseInt(unp_date[2]);

    								var unp_update = text.updated.substring(0,10).split("-");
    								var upyear = parseInt(unp_update[0]);
    								var upmonth = parseInt(unp_update[1]);
    								var upday = parseInt(unp_update[2]);
    								
    								displayGeneric(text.genre, text.z_authors, text.title, text.year, month, day, text.journal_name, text.doi_url, text.publisher, upyear, upmonth, upday, msg.volume, msg.issue, msg.page, "");
    							}; 
    							request2.send();							
    						}
    					}
    				};
    				request.send();
				}
			//website/other
			}else if(query.toLowerCase().startsWith("http://") || query.toLowerCase().startsWith("https://")){
				var d = new Date();
				displayGeneric("website", [], "", "", "", "", "", query, "", d.getFullYear(), d.getMonth() + 1, d.getDate(), "", "", "", "");
			}else{//book search display -- needs a cancel button
				var request = createCORSRequest("get", "https://www.googleapis.com/books/v1/volumes?q=" + query);
				if (request){
    				request.onload = function() {
    					var res = JSON.parse(request.responseText);
    					var booktext = "";
    					for(var i = 0; i < res.items.length; ++i){
    						booktext += "<br>";
    						booktext += "<input type='submit' class='btn btn-primary' value='Select' onclick='selectBook(" + i + ")'>  ";
    						booktext += "<i>" + res.items[i].volumeInfo.title + "</i>";
    						if(!res.items[i].volumeInfo.hasOwnProperty("authors") || res.items[i].volumeInfo.authors.length == 0){
    							booktext += ". ";
    						}else if(res.items[i].volumeInfo.authors.length == 1){
    							booktext += " by " + res.items[i].volumeInfo.authors[0] + ". ";
    						}else{
    							booktext += " by " + res.items[i].volumeInfo.authors[0] + " et al. ";
    						}
    						//console.log(JSON.stringify(res.items[i].volumeInfo));
    						if(res.items[i].volumeInfo.hasOwnProperty("publisher")){
    							booktext += res.items[i].volumeInfo.publisher + ", " + res.items[i].volumeInfo.publishedDate + ".<br>";
    						}else{
    							booktext += res.items[i].volumeInfo.publishedDate + ".<br>";
    						}
    					}
    					$('#searchresults').html(booktext);
    					$("#searchdiv").show();
    					booksshown = res;
    				};
    				request.send();
    			}
			}
			return false;
		}
		var citations = [];
		var format = "MLA";
		//in the future, may want to use journal_issns to normalize journal_names
		//formats: MLA, APA, Chicago (History), Chicago (Natural Science), IEEE
		function displayGeneric(_genre, _authors, _title, _year, _month, _day, _journal_name, _doi_url, _publisher, _updatedyear, _updatedmonth, _updatedday, _volume, _issue, _pages, _pubcity){//16 args
			var citation = {genre: _genre,
				authors: _authors,
				title: _title, 
				year: _year,
				month: _month,
				day: _day,
				journal_name: _journal_name,
				doi_url: _doi_url,
				publisher: _publisher,
				updatedyear: _updatedyear,
				updatedmonth: _updatedmonth,
				updatedday: _updatedday,
				volume: _volume,
				issue: _issue,
				pages: _pages,
				pubcity: _pubcity
			};
			//alert(citation.genre + ", " + citation.authors + ", " + citation.title + ", " + citation.year + ", " + citation.month + ", " + citation.day + ", " + citation.journal_name + ", " + citation.doi_url + ", " + citation.publisher + ", " + citation.updatedyear + ", " + citation.updatedmonth + ", " + citation.updatedday + ", " + citation.volume + ", " + citation.issue + ", " + citation.pages);
			currentCitation = citation;

			$('#vsf').val(citation.genre);
			//populate verifydiv with known values
			if(citation.hasOwnProperty('authors')){
				var htm = "";
				for(var i = 0; i < citation.authors.length; ++i){
					htm += "<div class='row'><div class='col-6'>First: <input type='text' class='vauthf form-control' value='" + formatLastName(citation.authors[i].given) + "'></div><div class='col-6'>Last: <input type='text' class='vauthl form-control' value='" + formatLastName(citation.authors[i].family) + "'></div></div>";
				}
				$("#authdiv").html(htm);
			}else{
				$("#authdiv").html("<div class='row'><div class='col-6'>First: <input type='text' class='vauthf form-control' value=''></div><div class='col-6'>Last: <input type='text' class='vauthl form-control' value=''></div></div>");
			}
			//$('#vauth').val("");
			
			$('#vtitl').val(citation.title);
			$('#vyear').val(citation.year);
			$('#vmont').val(citation.month);
			$('#vday').val(citation.day);
			$('#vjnam').val(citation.journal_name);
			$('#vurl').val(citation.doi_url);
			$('#vpubl').val(citation.publisher);
			$('#vpubloc').val(citation.pubcity);
			$('#vvol').val(citation.volume);
			$('#viss').val(citation.issue);
			$('#vpag').val(citation.pages);
			$('#vuyear').val(citation.updatedyear);
			$('#vumont').val(citation.updatedmonth);
			$('#vuday').val(citation.updatedday);


			$('#verifydiv').show();
		}
		var currentCitation = {};

		function changeAuthors(num){
			if(num == 0){
				var savf = document.getElementsByClassName("vauthf");
				var savl = document.getElementsByClassName("vauthl");
				var nijo = "";
				for(var a = 0; a < savf.length - 1; ++a){
					nijo += "<div class='row'><div class='col-6'>First: <input type='text' class='vauthf form-control' value='" + savf[a].value + "'></div><div class='col-6'>Last: <input type='text' class='vauthl form-control' value='" + savl[a].value + "'></div></div>";
				}
				$('#authdiv').html(nijo);
			}else{
				$('#authdiv').html($('#authdiv').html() + "<div class='row'><div class='col-6'>First: <input type='text' class='vauthf form-control' value=''></div><div class='col-6'>Last: <input type='text' class='vauthl form-control' value=''></div></div>");
			}
		}

		function createCORSRequest(method, url){
    		var xhr = new XMLHttpRequest();
    		if ("withCredentials" in xhr){
    		    xhr.open(method, url, true);
    		} else if (typeof XDomainRequest != "undefined"){
    		    xhr = new XDomainRequest();
    		    xhr.open(method, url);
    		} else {
    		    xhr = null;
    		}
    		return xhr;
		}
		function formatLastName(name){
			var spl = name.split(" ");
			var ret = "";
			if(spl.length > 0)
				ret += (spl[0].length >= 1 ? spl[0].substring(0, 1).toUpperCase() + spl[0].substring(1).toLowerCase() : "");
			for(var i = 1; i < spl.length; ++i){
				ret += (spl[i].length >= 1 ? " " + spl[i].substring(0, 1).toUpperCase() + spl[i].substring(1).toLowerCase() : "");
			}
			return ret;
		}
		function updateDisplay(){
			if(format == "MLA"){
				$("#savedcitations").html(generateMLA());
			}else if(format == "APA"){
				$("#savedcitations").html(generateAPA());
			}else if(format == "ChicagoA"){
				$("#savedcitations").html(generateChicago());
			}
			$("#citations").show();
		}
		function updateFormat(_format){
			format = _format;
			updateDisplay();
		}
		var booksshown = {};
		function selectBook(id){
			var item = booksshown.items[id].volumeInfo;
			var year = "", month = "", day = "";
			if(item.hasOwnProperty('publishedDate')){
				if(item.publishedDate.length == 4){
					year = item.publishedDate;
				}else if(item.publishedDate.length == 7){
					year = item.publishedDate.substring(0, 4);
					month = minz(item.publishedDate.substring(5,6));
				}else if(item.publishedDate.length == 10){
					year = item.publishedDate.substring(0, 4);
					month = minz(item.publishedDate.substring(5,7));
					day = minz(item.publishedDate.substring(8,10));
				}
			}
			$('#searchresults').html("");
    		$("#searchdiv").hide();


    		var request = createCORSRequest("get", "https://openlibrary.org/api/books?bibkeys=ISBN:" + item.industryIdentifiers[0].identifier + "&format=json&jscmd=data");
			if (request){
    			request.onload = function() {
    				var res = JSON.parse(request.responseText);
    				if(res.hasOwnProperty("ISBN:" + item.industryIdentifiers[0].identifier)){
    					displayGeneric("book", item.hasOwnProperty("authors") ? googAuthors(item.authors) : "", item.title, year, month, day, "", "", (item.hasOwnProperty("publisher") ? item.publisher : ""), "", "", "", "", "", "", (res["ISBN:" + item.industryIdentifiers[0].identifier].hasOwnProperty("publish_places") ? res["ISBN:" + item.industryIdentifiers[0].identifier].publish_places[0].name : ""));
    				}else{
    					displayGeneric("book", item.hasOwnProperty("authors") ? googAuthors(item.authors) : "", item.title, year, month, day, "", "", (item.hasOwnProperty("publisher") ? item.publisher : ""), "", "", "", "", "", "", "");
    				}
				};
    			request.send();
    		}else{
				//genre, _authors, _title, _year, _month, _day, _journal_name, _doi_url, _publisher, _updatedyear, _updatedmonth, _updatedday, _volume, _issue, _pages
				displayGeneric("book", item.hasOwnProperty("authors") ? googAuthors(item.authors) : "", item.title, year, month, day, "", "", (item.hasOwnProperty("publisher") ? item.publisher : ""), "", "", "", "", "", "", "");
			}
		}
		function minz (str){
			while(str.startsWith("0") && str.length > 1){
				str = str.substring(1);
			}
			return str;
		}
		function googAuthors (aut){
			var ret = [];
			for(var i = 0; i < aut.length; ++i){
				var a = aut[i];
				var last = a.split(" ")[a.split(" ").length - 1].trim();
				var first = a.substring(0, a.length - last.length).trim();
				ret.push({family: last, given: first});
			}
			return ret;
		}
		function authorText(cit){
			var fin = "";
			//author stuff
			if(cit.authors.length == 1){
				fin += cit.authors[0].family + (cit.authors[0].family != "" && cit.authors[0].given != "" ? ", " : "") + cit.authors[0].given;
			}else if(cit.authors.length == 2){
				fin += cit.authors[0].family + (cit.authors[0].family != "" && cit.authors[0].given != "" ? ", " : "") + cit.authors[0].given + " and " + cit.authors[1].family + (cit.authors[1].family != "" && cit.authors[1].given != "" ? ", " : "") + cit.authors[1].given;
			}else{
				for(var b = 0; b < cit.authors.length; ++b){
					fin += cit.authors[b].family + (cit.authors[b].family != "" && cit.authors[b].given != "" ? ", " : "") + cit.authors[b].given;
					if(b != cit.authors.length -1){
						fin += ", ";
					}
				}
			}
			if(cit.authors.length != 0){
				fin += ". ";
			}
			return fin;
		}
		function alphabeautify(version){
			var str = "";
			version.sort(function(a, b){
				var c = a.replace("<i>", "").replace("</i>", "").replace(" ", "").replace("\"", "").replace(".", "").replace(",", "");
				var d = b.replace("<i>", "").replace("</i>", "").replace(" ", "").replace("\"", "").replace(".", "").replace(",", "");
				return c > d;
			});
			for(var g = 0; g < version.length; ++g){
				str += version[g];
			}
			return str;
		}

		function sentenceAssemble(...items){
			var nl = [];
			for(var i = 0; i < items.length; ++i){
				if(items[i] != ""){
					nl.push(items[i]);
				}
			}
			if(nl.length >= 1){
				var str = "";
				for(var j = 0; j < nl.length - 1; ++j){
					str += nl[j] + ", ";
				}
				str += nl[nl.length - 1] + ".";
				return str;
			}else{
				return "";
			}
		}
		function dateFormat(year, month, day){
			if(day != "" && month != "" && year != ""){
				return day + " " + monthStr(month) + " " + year;
			}else if(month != "" && year != ""){
				return monthStr(month) + " " + year;
			}else if(year != ""){
				return year;
			}else if(month != "" && day != ""){
				return day + " " + monthStr(month);
			}else if(month != ""){
				return month;
			}else if(day != ""){
				return day;
			}
			return "";
		}
		function monthStr(month){
			if(month != ""){
				if(month == 1){
					return "Jan";
				}else if(month == 2){
					return "Feb";
				}else if(month == 3){
					return "Mar";
				}else if(month == 4){
					return "Apr";
				}else if(month == 5){
					return "May";
				}else if(month == 6){
					return "Jun";
				}else if(month == 7){
					return "Jul";
				}else if(month == 8){
					return "Aug";
				}else if(month == 9){
					return "Sep";
				}else if(month == 10){
					return "Oct";
				}else if(month == 11){
					return "Nov";
				}else if(month == 12){
					return "Dec";
				}
			}
			return "";
		}
		function clearCitations(){
			citations = [];
			document.cookie = "saved=;"
			updateDisplay();
		}
		/*

		TODO: 
		- Make sure multiple authors are correctly listed.
		- Fix ordering of works by same author
		- 

		*/
		function generateMLA(){
			var newversion = [];
			for(var a = 0; a < citations.length; ++a){
				var cit = citations[a];
				
				var fin = "<p>" + authorText(cit);
				if(cit.genre == 'journal-article'){
					fin += "\"" + cit.title + ".\"" + " <i>" + cit.journal_name + "</i>, vol. " + cit.volume + ", no. " + cit.issue + ", " + cit.year + ", ";
					if(cit.pages.includes("-")){
						fin += "pp. ";
					}else{
						fin += "p. ";
					}
					fin += cit.pages + ".";
				}else if(cit.genre == 'book'){
					fin += "<i>" + cit.title + "</i>. " + sentenceAssemble(cit.pubcity, cit.publisher, cit.year);
				}else if(cit.genre = 'website'){
					fin += "<i>" + cit.title + "</i>. " + sentenceAssemble(cit.publisher, dateFormat(cit.year, cit.month, cit.day), cit.doi_url) + (cit.updatedyear != "" || cit.updatedmonth != "" || cit.updatedday != "" ? " Accessed: " + dateFormat(cit.updatedyear, cit.updatedmonth, cit.updatedday) + ".": "");
				}
				newversion.push(fin + "</p>");
			}
			return alphabeautify(newversion);
		}

		function generateAPA(){
			var newversion = [];
			for(var a = 0; a < citations.length; ++a){
				var cit = citations[a];
				
				var fin = "<p>" + authorText(cit);
				if(cit.genre == 'journal-article'){
					fin += "\"" + cit.title + ".\"" + " <i>" + cit.journal_name + "</i>, vol. " + cit.volume + ", no. " + cit.issue + ", " + cit.year + ", ";
					if(cit.pages.includes("-")){
						fin += "pp. ";
					}else{
						fin += "p. ";
					}
					fin += cit.pages + ".";
				}else if(cit.genre == 'book'){
					fin += "<i>" + cit.title + "</i>. " + sentenceAssemble(cit.pubcity, cit.publisher, cit.year);
				}else if(cit.genre = 'website'){
					fin += "<i>" + cit.title + "</i>. " + sentenceAssemble(cit.publisher, dateFormat(cit.year, cit.month, cit.day), cit.doi_url) + (cit.updatedyear != "" || cit.updatedmonth != "" || cit.updatedday != "" ? " Accessed: " + dateFormat(cit.updatedyear, cit.updatedmonth, cit.updatedday) + ".": "");
				}
				newversion.push(fin + "</p>");
			}
			return alphabeautify(newversion);
		}
		function generateChicago(){
			var newversion = [];
			for(var a = 0; a < citations.length; ++a){
				var cit = citations[a];
				
				var fin = "<p>" + authorText(cit);
				if(cit.genre == 'journal-article'){
					fin += "\"" + cit.title + ".\"" + " <i>" + cit.journal_name + "</i>, vol. " + cit.volume + ", no. " + cit.issue + ", " + cit.year + ", ";
					if(cit.pages.includes("-")){
						fin += "pp. ";
					}else{
						fin += "p. ";
					}
					fin += cit.pages + ".";
				}else if(cit.genre == 'book'){
					fin += "<i>" + cit.title + "</i>. " + sentenceAssemble(cit.pubcity, cit.publisher, cit.year);
				}else if(cit.genre = 'website'){
					fin += "<i>" + cit.title + "</i>. " + sentenceAssemble(cit.publisher, dateFormat(cit.year, cit.month, cit.day), cit.doi_url) + (cit.updatedyear != "" || cit.updatedmonth != "" || cit.updatedday != "" ? " Accessed: " + dateFormat(cit.updatedyear, cit.updatedmonth, cit.updatedday) + ".": "");
				}
				newversion.push(fin + "</p>");
			}
			return alphabeautify(newversion);
		}
	</script>
</body>
</html>